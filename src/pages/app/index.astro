---
import Layout from "@layouts/Base.astro";

if (!Astro.locals.session) {
	// Redirect to login page if the user is not authenticated
	return Astro.redirect(
		// `/login?returnUrl=${encodeURIComponent(Astro.url.pathname)}`,
		`/app/login`,
	);
}
---

<Layout>
	<main class="u-guttered">
		<h1>Home</h1>
		<ul>
			{
				Object.entries(Astro.locals.session).map(([key, value]) => (
					<li>
						{key}: {JSON.stringify(value)}
					</li>
				))
			}
		</ul>
		<button id="signOutButton">Sign Out</button>
	</main>
</Layout>

<script>
	import { authClient } from "@utils/client/auth-client";
	document
		.getElementById("signOutButton")
		?.addEventListener("click", async () => {
			await authClient.signOut();
			window.location.href = "/app/login";
		});
</script>
